---
layout: post
title: Teensy Audio Board - First Audio
author: Chip
---


After having <a href="http://openaudio.blogspot.com/2016/10/benchmarking-teensy-36-is-fast.html">good success</a> with the speed of the Teensy products for doing audio-relevant operations, I've decided that it's now time to start playing with actual audio signals. &nbsp;To do this, I need some sort of interface for getting analog audio signals into and out of the Teensy. &nbsp;Luckily, Teensy makes an audio board just for this purpose. &nbsp;Today, I'm going to give the Teensy Audio Board a try.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-mWGAxSqhU0A/WA1eSwkWyiI/AAAAAAAAD98/MmmnBfOuPoAuUFD-2y0oYKT07w0CmeTewCK4B/s1600/TeensyAndAudioBoard.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="245" src="https://1.bp.blogspot.com/-mWGAxSqhU0A/WA1eSwkWyiI/AAAAAAAAD98/MmmnBfOuPoAuUFD-2y0oYKT07w0CmeTewCK4B/s400/TeensyAndAudioBoard.png" width="400" /></a></div><br /><u>Buying The Parts</u>: &nbsp;The first step of a new project is always fun: buying the parts. &nbsp;I go to Adafruit or Sparkfun, I see what they have in stock, and I order all the stuff that I need. &nbsp;This is the part of the project where the vision and dream fills one with excitement, without being tempered by any of the actual hardware and frustration that comes with building and trouble-shooting. &nbsp;And if that wasn't good enough, in a few days, you get a box full of shiny things!<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-BB_g5t44Xis/WAy_YzXn-gI/AAAAAAAAD8c/Kpn4OP7Tao82tdkkf_X3GyQKM22VtZ2xACK4B/s1600/IMG_6783.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="266" src="https://1.bp.blogspot.com/-BB_g5t44Xis/WAy_YzXn-gI/AAAAAAAAD8c/Kpn4OP7Tao82tdkkf_X3GyQKM22VtZ2xACK4B/s400/IMG_6783.JPG" width="400" /></a></div><br /><div style="text-align: center;"></div>For this project, I used a&nbsp;<a href="https://www.adafruit.com/products/2756">Teensy 3.2,</a>&nbsp;a&nbsp;<a href="https://www.adafruit.com/products/1780">Teensy Audio Board</a>, some&nbsp;<a href="http://www.digikey.com/product-detail/en/sullins-connector-solutions/PPTC141LFBN-RC/S7012-ND/810152">14-pin female headers</a>&nbsp;for the Audio Board, a&nbsp;<a href="https://www.adafruit.com/products/356">10K pot</a>&nbsp;to fit into the "volume knob" spot on the Audio Board, and a&nbsp;<a href="http://www.digikey.com/product-detail/en/switchcraft-inc/35RAPC2BV4/SC1460-ND/389168">3.5 mm stereo audio jack</a>. <br /><div><br /></div><u>Assembling the Audio Board:</u>&nbsp; This part of the project was pretty straight-forward. &nbsp;Simply solder on the female headers, solder on the 10K pot, and solder some wires between the "Line-In" holes on the Audio Board and the 3.mm audio jack.. &nbsp;As you can see in the photo below, I could have done a better job with the audio jack, but it's good enough for this project. &nbsp;(And thanks to Ray for giving it a nice sturdy plastic base!)<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-6qo8l--npno/WAzL1QjPj-I/AAAAAAAAD8s/VO3L4WmyImYfGCSLtCjZPLS_6kD28I8gQCK4B/s1600/AudioBoard.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="267" src="https://3.bp.blogspot.com/-6qo8l--npno/WAzL1QjPj-I/AAAAAAAAD8s/VO3L4WmyImYfGCSLtCjZPLS_6kD28I8gQCK4B/s400/AudioBoard.JPG" width="400" /></a></div><br /><u>Assemble with the Teensy:</u>&nbsp; After finishing the assembly of the Audio Board, I turned to the Teensy itself. &nbsp;All that is needed is to solder on some male pin headers. &nbsp;Then, the Teensy can be connected to the Audio Board.<br /><u><br /></u><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-2JlgJbOfVK4/WAzL6Qp_VtI/AAAAAAAAD80/Mo_5HviM7No0EmXf5XFHD1veENAmMq4MwCK4B/s1600/PuttingOnTeensyToAudioBoard.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="265" src="https://3.bp.blogspot.com/-2JlgJbOfVK4/WAzL6Qp_VtI/AAAAAAAAD80/Mo_5HviM7No0EmXf5XFHD1veENAmMq4MwCK4B/s400/PuttingOnTeensyToAudioBoard.JPG" width="400" /></a></div><br /><u>Audio Software:</u>&nbsp; To use the Teensy with the Audio Board, you some software that tells the Teensy how to interact with the Audio Board. &nbsp;Because audio programming can be tricky, PJRC (the Teensy folks) have written a pretty extensive audio library. &nbsp;It's pretty impressive. &nbsp;I chose to use this library for my initial trials. &nbsp;You can get the library from their GitHub repo (as described&nbsp;<a href="http://www.pjrc.com/teensy/td_libs_Audio.html">here</a>) or, even easier, it was probably already installed on your computer when you first installed the drivers for the Teensy itself (via the "Teensyduino" <a href="http://www.pjrc.com/teensy/td_download.html">installer</a>).<br /><br /><u>Audio System Design Tool:</u>&nbsp; The hardest part of doing something new is getting started. &nbsp;Where do I begin? &nbsp;Well, PJRC knows that this is a hurdle, so they help you get started by providing a <a href="http://www.pjrc.com/teensy/gui/">web-based GUI</a> for configuring your audio processing. &nbsp;The idea with this GUI is that it will help you build your software <i>for the Teensy</i>. &nbsp;The Teensy doesn't know about the Audio Board -- you have to tell it everything. &nbsp;So, as you can see in the screenshot below, I started by dragging in a module called "sgtl5000". &nbsp;The SGTL5000 is the audio codec at the heart of the Teensy Audio Board, so by using the module, the Teensy will now know about the Teensy Audio Board. <br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-sUj23RV87BY/WAzQK9NspeI/AAAAAAAAD9M/Fy35PA8VpeAs4d-s1ZAdTi9A0vOqi_OwACK4B/s1600/AudioGUI.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="255" src="https://2.bp.blogspot.com/-sUj23RV87BY/WAzQK9NspeI/AAAAAAAAD9M/Fy35PA8VpeAs4d-s1ZAdTi9A0vOqi_OwACK4B/s400/AudioGUI.png" width="400" /></a></div><br /><u>Line-In Pass-Through:</u>&nbsp;&nbsp;The next step is to configure the audio path that I'd like. &nbsp;For this demo, I simply want to pass audio from the Line-In input to the headphone output. &nbsp;From the Teensy's perspective, the Audio Board will provide these signals to the Teensy over the Teeny's I2S bus. &nbsp;So, in the GUI, I &nbsp;dragged in an I2S input module and I dragged in an I2S output module. &nbsp;Finally, I drew lines connecting the inputs to the outputs (the two lines represent the left and right audio channels). &nbsp;And that's it! <br /><br /><u>Exporting to the Arudino IDE:</u>&nbsp;&nbsp;This GUI is merely a tool to help you get started with configuring your audio processing chain. &nbsp;It doesn't compose all of the software for me. &nbsp;Instead, I need to export this audio configuration and get it into the Arduino IDE, where I can complete the programming and put it on the Teensy. &nbsp;So, I clicked on the GUI's "Export" button, at which point it pops up a window with a bunch of Arduino code ready to be copied-and-pasted into a new Arduino sketch. <br /><br /><u>The GUI-Provided Arduino Code:</u>&nbsp;&nbsp;The figure below shows a screen-shot of my completed sketch in the Arduino IDE. &nbsp;The first part of the sketch is the code provided by the web-based GUI tool. &nbsp;This code imports the required libraries, instantiates the required audio-related objects, and connects them together per the drawing that I made in the GUI. <br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-4CQGzUxM12M/WAzQVE7dcbI/AAAAAAAAD9U/SRnfkl4MTFcceK8e9IQdzZSqm5-VXVvSwCK4B/s1600/ArduinoScreenShot.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="https://4.bp.blogspot.com/-4CQGzUxM12M/WAzQVE7dcbI/AAAAAAAAD9U/SRnfkl4MTFcceK8e9IQdzZSqm5-VXVvSwCK4B/s400/ArduinoScreenShot.png" width="377" /></a></div><br /><u>Completing the Software:</u>&nbsp;&nbsp;The second half of the program is the code that I had to write myself. &nbsp;I had to write the "setup()" and "loop()" functions that are the core of every Arduino sketch. &nbsp;As you can see in my "setup()" function above, I do a couple of things: (1) I allocate some memory for the audio library to use and (2) I issue a few commands to configure the settings within Audio Board. &nbsp;I stole all of this code from example programs in the Audio library. &nbsp;After the "setup()" function, I wrote the "loop()" function. &nbsp;Based on the example code, I don't need anything here. &nbsp;Once properly configured, the Audio Library handles everything in the background. &nbsp;My code is on my GitHub <a href="https://github.com/chipaudette/OpenAudio_blog/tree/master/2016-10-23%20First%20Teensy%20Audio/Arduino/BasicLineInPassThrough">here</a>.<br /><br /><u>First Audio Testing:</u>&nbsp; For my first audio test, I simply want to inject an audio signal into the Teensy and record the audio signal that it produces in response. &nbsp;Since the Teensy was programmed to pass the audio through without any manipulations, the output should be the same as the input. &nbsp;Let's see! <br /><br /><u>Setup:</u>&nbsp; I compiled the code and loaded onto the Teensy. &nbsp;To generate a test signal, I used my computer. &nbsp;I used&nbsp;<a href="http://www.audacityteam.org/">Audacity </a>to make a linear frequency sweep (a "chirp") and played it out of the computer's headphone jack. &nbsp;I connected the headphone output of my computer to the Line-In jack on the Teensy Audio Board. &nbsp;I recorded the audio output of the Teensy Audio Board by connecting its headphone output to a Roland R-05 handheld audio recorder that I happen to have. &nbsp;I hit record on the Roland and I hit play in Audacity and, like MAGIC!, I found that I had audio passing through the Teensy. &nbsp; Yay!<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-L0urAnRwNYc/WAzNEm3e61I/AAAAAAAAD88/h9Ik9lZvXzY5-h3-F0iHuGtFqoA-jF5kACK4B/s1600/RecordingAudioOut.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="285" src="https://3.bp.blogspot.com/-L0urAnRwNYc/WAzNEm3e61I/AAAAAAAAD88/h9Ik9lZvXzY5-h3-F0iHuGtFqoA-jF5kACK4B/s400/RecordingAudioOut.JPG" width="400" /></a></div><br /><u>First Data:</u>&nbsp; After recording the audio chirp with the Roland, I transferred the audio file over to the PC and opened it in Audacity (available <a href="https://github.com/chipaudette/OpenAudio_blog/tree/master/2016-10-23%20First%20Teensy%20Audio/AudioTest-HeadphoneOut">here</a>). &nbsp;As can be seen in the screen shot below, it does indeed look like a chirp, which is good. &nbsp;I also see, however, that it is not a pure chirp signal -- I see some unexpected lines in the spectrogram. &nbsp;To me, these spurious lines look like harmonic distortion and some sort of aliasing. &nbsp;These undesirable signals are not very loud compared to the primary signal, but they are clearly present. &nbsp;So, while I'm pleased with my initial success with getting this Teensy-based audio system to work, I also see that there is some work ahead to optimize the audio quality.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-nXk8D5GBTFg/WAzR_rzZYZI/AAAAAAAAD9g/GKvt_SXWmBEQevKi8S1eeY3OwdJSlF8pwCK4B/s1600/AudacityScreenshot-HeadphoneRecording.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="273" src="https://2.bp.blogspot.com/-nXk8D5GBTFg/WAzR_rzZYZI/AAAAAAAAD9g/GKvt_SXWmBEQevKi8S1eeY3OwdJSlF8pwCK4B/s400/AudacityScreenshot-HeadphoneRecording.png" width="400" /></a></div><br /><u>Next Steps:</u>&nbsp; My next steps are to investigate other features of the Audio library (the audio library provides for USB-based audio transfer!?! &nbsp;That's pretty advanced!) and to try the Audio Board with the Teensy 3.6 instead of the Teensy 3.2. &nbsp;There's fun times ahead with audio hacking!<br /><br /><u>Follow-Up:</u>&nbsp; I made my own <a href="http://openaudio.blogspot.com/2016/11/a-teensy-hearing-aid.html">Teensy Hearing Aid</a> using a Teensy and a Teensy Audio Board. &nbsp;It's fun!
