---
layout: post
title: Teensy Audio Board Self-Noise
author: Chip
image: https://1.bp.blogspot.com/-ipuD0P2yNRM/WMVbRyokdTI/AAAAAAAAELw/yTc0SNtE7x8gdwTvuZzEws52rz1WYnjxQCLcB/s400/Teensy%2BSelf-Noise.png
---


When working with audio, one typically wants as quiet a system as possible -- no one likes listening to hiss. &nbsp;So, when I started working with the Teensy and the Teensy Audio Board, I applied a critical ear to the board's performance. &nbsp;While the Teensy Audio Board was very fun, quite easy to use, and relatively inexpensive, I found that it was noisier than I like. &nbsp;In this post, I'm going to illustrate the noise levels that I recorded and I'll show a workaround that helped remove a lot of that noise.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-ipuD0P2yNRM/WMVbRyokdTI/AAAAAAAAELw/yTc0SNtE7x8gdwTvuZzEws52rz1WYnjxQCLcB/s1600/Teensy%2BSelf-Noise.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="255" src="https://1.bp.blogspot.com/-ipuD0P2yNRM/WMVbRyokdTI/AAAAAAAAELw/yTc0SNtE7x8gdwTvuZzEws52rz1WYnjxQCLcB/s400/Teensy%2BSelf-Noise.png" width="400" /></a></div><br /><u>Setup</u>: &nbsp;For these tests, I used a <a href="https://www.pjrc.com/store/teensy36.html">Teensy 3.6</a> attached to <a href="https://www.pjrc.com/store/teensy3_audio.html">Teensy Audio Board</a>. &nbsp;I then wrote an Arduino sketch (shared on my GitHub <a href="https://github.com/chipaudette/OpenAudio_blog/tree/master/2017-03-11%20Teensy%20and%20Tympan%20Self%20Noise/Arduino">here</a>) that would record audio from the line-in and send it to both the headphone output as well as to the USB Audio output. &nbsp;I recorded the digital audio coming through USB using Audacity (as discussed <a href="http://openaudio.blogspot.com/2016/10/teensy-audio-over-usb.html">here</a>). &nbsp;As shown in the picture above, To try to isolate just the self-noise of the system, I shorted the inputs using a jumper across the Teensy Audio Boards line-in terminals. &nbsp;This should be as quiet as it can get.<br /><br /><u>First Results:</u>&nbsp; The audio that I recorded (shared <a href="https://github.com/chipaudette/OpenAudio_blog/raw/master/2017-03-11%20Teensy%20and%20Tympan%20Self%20Noise/Data/TeensyRawData/USB/3%20-%20LineIn10%20-%20Teensy3.6%2096%20MHz%20-%20USBaudio%20-%20LineInJackShorted%20-%20Headphone0.5.wav">here</a>) sounded funny to my ear. &nbsp;If I turned it up, I could hear a very annoying unsteady whining noise. &nbsp;Looking at the spectrum (see plot below), I could clearly see some narrowband tones starting around 2 kHz. &nbsp;That's right where one's hearing is most sensitive, which makes this kind of self-noise particularly problematic. &nbsp;It's definitely not what you want if you're trying to make a hearing aid type of device. &nbsp;What could be the cause of this?<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-Ds9vTJ4bJFg/WMVkh1J0S8I/AAAAAAAAEMA/ew4MMzjxh3kW3neoMSVX15dFQPjoRlrDgCLcB/s1600/Teensy-Spectrum_wADC.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="281" src="https://4.bp.blogspot.com/-Ds9vTJ4bJFg/WMVkh1J0S8I/AAAAAAAAEMA/ew4MMzjxh3kW3neoMSVX15dFQPjoRlrDgCLcB/s400/Teensy-Spectrum_wADC.png" width="400" /></a></div><u>Disable the ADC's HP Filter:</u>&nbsp; After a bunch of messing around, I finally stumbled across <a href="https://forum.pjrc.com/threads/27215-24-bit-audio-boards?p=78831&amp;viewfull=1#post78831">this post</a> on tthe Teensy forum. &nbsp; Here, "Raj" stated that the SGTL5000 audio codec (which is at the heart of the Teensy Audio Board) has a high-pass filter in its ADC. &nbsp;He said that this HP filter was introducing a lot of noise and he shared the command for disabling that filter. &nbsp;When I put the command "adcHighPassFilterDisable();" into my sketch and re-ran my tests, those annoying narrowband tones in the Teensy Board's self-noise went away (audio file <a href="https://github.com/chipaudette/OpenAudio_blog/raw/master/2017-03-11%20Teensy%20and%20Tympan%20Self%20Noise/Data/TeensyRawData/USB/7%20-%20LineIn10%20-%20ADCHPDisabled%20-%20Teensy3.6%2096%20MHz%20-%20USBaudio%20-%20LineInJackShorted%20-%20Headphone0.5.wav">here</a>). &nbsp;Ahhh. &nbsp;That's so much better.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-OXahNXLQ21g/WMVkqW7IT9I/AAAAAAAAEMI/XnLJ35ZS6FQNxLDGjg_QXKrbluQ1ufsdQCLcB/s1600/Teensy-Spectrum_wNoADC.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="282" src="https://4.bp.blogspot.com/-OXahNXLQ21g/WMVkqW7IT9I/AAAAAAAAEMI/XnLJ35ZS6FQNxLDGjg_QXKrbluQ1ufsdQCLcB/s400/Teensy-Spectrum_wNoADC.png" width="400" /></a></div><u>Varying the Gain:</u>&nbsp; The data shown above were taken with the input gain of the Teensy board set to "10" (ie, full-scale input spans 0.56 Vpp). &nbsp;There are other gain settings that one could use. &nbsp;So, I repeated my measurements at other gain levels to see if the input-referred self-noise was better or worse. &nbsp;The results are below.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-jXy8SI1ujq4/WMVk12W2aHI/AAAAAAAAEMQ/Hsn-EfCge2EK7Rr8M8_nlgKciq5_M6PagCLcB/s1600/Teensy-SelfNoiseVsGain.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="331" src="https://3.bp.blogspot.com/-jXy8SI1ujq4/WMVk12W2aHI/AAAAAAAAEMQ/Hsn-EfCge2EK7Rr8M8_nlgKciq5_M6PagCLcB/s400/Teensy-SelfNoiseVsGain.png" width="400" /></a></div>&nbsp;As can be seen, the noise with the HP filter (the blue line) is noisier in all cases than when the HP filter is disabled (orange line). &nbsp;So, as long as you can handle a little DC offset in your audio data, you should definitely disable that filter. <br /><br />A second finding is that the apparent (input-referred) self-noise goes down as the gain increases. &nbsp;So, if you have really quiet signals that you're trying to record, turning up the gain might help reveal those signals. <br /><br /><u>Dynamic Range</u>: &nbsp;The trade-off with turning up the gain is that the maximum signal level that can be recorded without clipping also goes down as the gain is increased. &nbsp;For many applications, therefore, it is just as important to look at the dynamic range for the system. &nbsp;The dynamic range is the difference between the maximum input level and the noise floor. &nbsp;When I run the numbers for the Teensy Audio Board, I get the results below.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-GHarRuJ3e9k/WMVk8hnBQPI/AAAAAAAAEMU/Rw9p8u9rJTwef7DpAKP9-N0CekLRDg4oQCLcB/s1600/Teensy-DynRangeVsGain.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="331" src="https://4.bp.blogspot.com/-GHarRuJ3e9k/WMVk8hnBQPI/AAAAAAAAEMU/Rw9p8u9rJTwef7DpAKP9-N0CekLRDg4oQCLcB/s400/Teensy-DynRangeVsGain.png" width="400" /></a></div>Here, I see that, when the HP filter is disabled (the orange line), the Teensy Audio Board has about 81 dB of dynamic range. &nbsp;And, I also see that the dynamic range is basically independent of the gain setting. <br /><br /><u>Is it Good Enough?</u>&nbsp; So now we're down to the hard question: &nbsp;is 81 dB of dynamic range good enough for my needs? &nbsp;Well, it is a pretty decent number, especially for the price of the Teensy Audio Board. &nbsp;But, for my use as part of an open-source hearing aid, where I need to amplify quiet sounds while not distorting on already-loud sounds, I think that I need a bigger dynamic range. &nbsp;Normal human hearing spans on the order of 120 dB of dynamic range. &nbsp;I think that I need hardware that'll get me at least a little closer to that number.<br /><br /><u>Motivation for a New Board:</u>&nbsp; The results shown here were my motivation for building the audio interface (the "Tympan") that I introduced in <a href="http://openaudio.blogspot.com/2017/03/unifying-electronics-to-make-tympan.html">my last post</a>. &nbsp;In my next post, I'll share some details of that audio interface and I'll perform these same self-noise measurements to see if I was able to get a wider dynamic range. &nbsp;Making wide dynamic range systems isn't easy, so it'll be exciting to find out how I did!<br /><br /><u>Follow-Up:</u>&nbsp; I measured the self-noise and dynamic range of the new Tympan board. &nbsp;It's pretty good! &nbsp;If you're interested, you can see the results <a href="http://openaudio.blogspot.com/2017/03/tympan-self-noise.html">here</a>.
