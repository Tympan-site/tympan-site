---
layout: post
title: Calibrating My Earphones with the Tympan
author: Chip
image: https://3.bp.blogspot.com/-YHx3Dw6w20A/WSJHTaQCufI/AAAAAAAAERs/svQJTFUjgAE6ej0GD_803q0QgdqHwLJMgCLcB/s640/Setup.png
---


At its core, a hearing aid is a microphone, an amplifier, and an earphone. &nbsp;Each element is critical to the quality of the sound produced by the device. &nbsp;For the Tympan, it (currently) is simply the amplifier (ie, the electronics) -- you have to bring your own microphones and speakers. &nbsp;In my last post, I looked at a few different microphones. &nbsp;Today, I'm going to look at some earphones. &nbsp;I'm going to calibrate a set of earphones with the Tympan to measure the frequency response and overall loudness.<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-YHx3Dw6w20A/WSJHTaQCufI/AAAAAAAAERs/svQJTFUjgAE6ej0GD_803q0QgdqHwLJMgCLcB/s1600/Setup.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="176" src="https://3.bp.blogspot.com/-YHx3Dw6w20A/WSJHTaQCufI/AAAAAAAAERs/svQJTFUjgAE6ej0GD_803q0QgdqHwLJMgCLcB/s640/Setup.png" width="480" /></a></div><u>Earphones:</u>&nbsp; The earphones that I'm going to calibrate are my Klipsch S4 earbuds. &nbsp;They are absolutely nothing special. &nbsp;They are simply low-cost, consumer-level earbuds like anyone might have. &nbsp;I think that inexpensive earbuds are where a lot of people will start when using the Tympan, so it's where I'm going to start with my earphone calibration.<br /><u><br /></u><u>Setup:</u>&nbsp; My overall setup is shown in the figure above. &nbsp;I'm using the the Tympan electronics to drive the earbuds. &nbsp;The Tympan has been programmed to generate a tone that sweeps from low frequency to high frequency . &nbsp;The earbuds are fixed in a coupler, which mates to a laboratory-grade microphone (B&amp;K 4192) and data acquisition system. &nbsp;So, by generating tones at known digital level in the Tympan, I can measure the corresponding sound pressure level produced by the earbuds in the 2cc coupler.<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-9rCSRrIFPOU/WSLEGjk8ZsI/AAAAAAAAESE/piRkgG3icWcOBlIA7wy4NJv0NtaZ_7sEQCLcB/s1600/Coupler%2BPieces.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="177" src="https://4.bp.blogspot.com/-9rCSRrIFPOU/WSLEGjk8ZsI/AAAAAAAAESE/piRkgG3icWcOBlIA7wy4NJv0NtaZ_7sEQCLcB/s400/Coupler%2BPieces.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Using the B&amp;K 4949 2cc Coupler</td></tr></tbody></table><u>Coupler:</u>&nbsp; The coupler is a very important part of this setup. &nbsp;Earbuds are supposed to be worn in an ear canal. &nbsp;There is very little volume in your ear canal that the earbud needs to drive. &nbsp;So, if you want to measure the response of an earbud, you need to use a coupler that creates a similar small-volume environment.<br /><br /><u>Which Coupler to Use?</u>&nbsp; There are two typical choices for couplers for this kind of testing: (1) an ANSI-standard 2cc coupler, or (2) a so-called "artificial ear". &nbsp;While the artificial ear is designed to give a more realistic response, a basic 2cc coupler is what the ANSI standard uses for hearing aid assessment, so that's what I'm starting with. &nbsp;My 2cc coupler is a B&amp;K Type 4946, shown above.<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-wFclJezRolw/WSeEQR-QYbI/AAAAAAAAESU/J-oX8olgac0tSsa_1Z91nXwo5OKRFN9HQCLcB/s1600/Fitting%2Bthe%2BEarbud.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="550" data-original-width="1012" height="216" src="https://3.bp.blogspot.com/-wFclJezRolw/WSeEQR-QYbI/AAAAAAAAESU/J-oX8olgac0tSsa_1Z91nXwo5OKRFN9HQCLcB/s400/Fitting%2Bthe%2BEarbud.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Fitting my earbud to the coupler's adapter. &nbsp;The output of the earbud should be flush with the hole in the adapter plate.</td></tr></tbody></table><u><br /></u><u>Fitting the Earbud:</u>&nbsp; The 4949 includes different adapter pieces to help fit a variety of hearing aid styles. &nbsp;For my earbud, I chose to use the broad dish-shaped adapter piece intended for in-the-ear hearing aids. &nbsp;As you can see above, I used putty to hold the earbud in place and positioned the earbud such that the output of the earbud is flush with the opening of the adapter. &nbsp;It isn't pretty, but I think that it gets the job done.<br /><u><br /></u><u>Completing the Setup:</u>&nbsp; Once the earbud and adapter plate were fit to one end of the coupler, I inserted the measurement microphone into the other end of the coupler. &nbsp;I connected the earbuds to the Tympan electronics and programmed the electronics to produce frequency sweeps at different digital levels (my code is on my GitHub <a href="https://github.com/chipaudette/OpenAudio_blog/tree/master/2017-05-22%20Calibrating%20Klipsh%20Earphones/Arduino/ToneSweep_Tympan">here</a>).<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-zjERpcxD__E/WSJHY4ym6-I/AAAAAAAAERw/IxjBCzJNk_oUPSI678HIdCuUm8WfVzQZgCLcB/s1600/Earphone%2Bin%2BCoupler.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="201" src="https://3.bp.blogspot.com/-zjERpcxD__E/WSJHY4ym6-I/AAAAAAAAERw/IxjBCzJNk_oUPSI678HIdCuUm8WfVzQZgCLcB/s320/Earphone%2Bin%2BCoupler.jpg" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">My setup used to calibrate the Tympan output with my Klipsch consumer-level earbuds.</td></tr></tbody></table><u>Raw Data:</u>&nbsp; Some raw data from this measurement is shown below (raw data is in my GitHub <a href="https://github.com/chipaudette/OpenAudio_blog/tree/master/2017-05-22%20Calibrating%20Klipsh%20Earphones/TestData/BK_Data">here</a>). &nbsp;It is the measured sound output from the earpbud as measured by the microphone in the 2cc coupler. &nbsp;This microphone is calibrated to units of Pascals from which sound pressure level (SPL) is easily computed. &nbsp;As you can see, I had the Tympan generate five frequency sweeps, each one at a louder amplitude.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-4hicwdM3tl0/WSeL5un1NzI/AAAAAAAAESk/Qpy3IJn1WBw2kfDoCEnosJXQ8pABoe-xACLcB/s1600/RawData.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="338" data-original-width="491" height="275" src="https://1.bp.blogspot.com/-4hicwdM3tl0/WSeL5un1NzI/AAAAAAAAESk/Qpy3IJn1WBw2kfDoCEnosJXQ8pABoe-xACLcB/s400/RawData.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Raw data recorded from the Klipsch earbuds during this calibration testing.</td></tr></tbody></table><u>Actual Amplitude:</u>&nbsp; In my Arduino code, I thought that I was commanding the amplitude to step from 0.1 up to 1.0. &nbsp;In later analysis, however, I discovered that the ToneSweep object from the Teensy Audio library only produces half the amplitude that you think. &nbsp;So, when you command "1.0", you actually get an amplitude of 0.5. &nbsp;I confirmed through by sending the audio out the USB Audio connection to the PC. &nbsp;It was half. &nbsp;So, instead of spanning 0.1 to 1.0, my test spanned only 0.05 to 0.5.<br /><br /><u>Low-Level Noise:</u>&nbsp; When I looked at this raw data in the frequency domain (see spectrogram below), I was surprised to see this strange, low-level background noise appear at the higher drive levels. &nbsp;It first appears at a digital drive level of 0.25. &nbsp;What is this? &nbsp;At lower drive levels it is not there -- it just magically appears at 0.25. &nbsp;This is very strange. <br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://2.bp.blogspot.com/-oFV1aCxFAzo/WSeO8GL6csI/AAAAAAAAES4/MZVU6bBZuiU2dNaINPkeu-VKfwVzwbZ4wCLcB/s1600/Klipsch%2BSpectrogram.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="335" data-original-width="490" height="272" src="https://2.bp.blogspot.com/-oFV1aCxFAzo/WSeO8GL6csI/AAAAAAAAES4/MZVU6bBZuiU2dNaINPkeu-VKfwVzwbZ4wCLcB/s400/Klipsch%2BSpectrogram.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="font-size: 12.8px;">Spectrogram of audio produced by the Tympan via the Klipsch earbuds during the calibration tests. &nbsp;When the drive amplitude is 0.25 and above, a low-level background noise appears.</td></tr></tbody></table>[Follow-Up: Additional testing suggests that this noise might be related to the Tympan's audio codec (TI 3206) struggling to deliver the required current to these low impedance (18 ohm) earbuds. &nbsp;That's my current working theory, but I cannot yet definitely confirm that that's the issue. &nbsp;I'll have to do more examination of this in the future.]<br /><br /><u>Data Analysis:</u>&nbsp; From this raw data, I divided the recording to isolate each frequency sweep. &nbsp;Then I measured the SPL at each frequency (analysis code <a href="https://github.com/chipaudette/OpenAudio_blog/tree/master/2017-05-22%20Calibrating%20Klipsh%20Earphones/TestData">here</a>, more Matlab functions <span id="goog_2106970117"></span><a href="https://github.com/chipaudette/OpenAudio_blog/tree/master/MatlabFunctions">here</a><span id="goog_2106970118"></span>). &nbsp;For each drive amplitude, the measured response is shown in the figure below. &nbsp;As expected, the frequency response is basically independent of amplitude, which is good.<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-DHqzfJgXocc/WSeOXEcy9LI/AAAAAAAAESw/Gr6iXO1Msws0Q7MC3pfUUMHklpa-X2zIwCLcB/s1600/SPL%2Bfor%2BEach%2BSweep.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="335" data-original-width="490" height="272" src="https://1.bp.blogspot.com/-DHqzfJgXocc/WSeOXEcy9LI/AAAAAAAAESw/Gr6iXO1Msws0Q7MC3pfUUMHklpa-X2zIwCLcB/s400/SPL%2Bfor%2BEach%2BSweep.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Measured frequency response for different drive levels.</td></tr></tbody></table><u>The Bottom Line:</u>&nbsp; The figure below is how I chose to summarize these results. &nbsp;The red line is the measured frequency response and loudness when driving at an amplitude of 0.25, which is when that low-level noise/distortion appears. &nbsp;The blue line is the frequency response that I measured at my strongest drive level (0.5 relative to full scale) that I then scaled up as if I had driven it at the hardware's maximum drive level (1.0 relative to digital full scale). &nbsp;As can be seen, at 1 kHz, the system should be able to produce about 117 dB SPL at full drive.<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-6UlUlwBkfQc/WSJHcV9dK2I/AAAAAAAAER0/7qxHCdq8KWUBMJOmMIhxWj_KId8493-uACLcB/s1600/Klipsch%2BEarphone%2BCalibration.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="286" src="https://1.bp.blogspot.com/-6UlUlwBkfQc/WSJHcV9dK2I/AAAAAAAAER0/7qxHCdq8KWUBMJOmMIhxWj_KId8493-uACLcB/s400/Klipsch%2BEarphone%2BCalibration.png" width="400" /></a></div><u>Bass Boost:</u>&nbsp; A secondary result that is obvious in this graph is that these earphones do not have a flat frequency response. &nbsp;Not at all. &nbsp;These consumer-level earphones clearly provide a strong boost to the frequencies below, say, 500 Hz. &nbsp;I'm guessing that this bass boost this was a conscious decision by the designers in order to appeal to a certain segment of the earbud market. &nbsp;This is perhaps not the ideal response for a hearing instrument. &nbsp;I'm curious to test other earphones to see which earbuds might have a more flat response.<br /><br /><u>Caveat:</u>&nbsp; An important caveat to this work is that the measurements were taken using a 2cc coupler. &nbsp;Your ear is NOT the same as the 2cc coupler. &nbsp;In a real ear, the frequency response could be quite different. &nbsp;Perhaps the overal SPL produced by the earphones will be higher (or lower). &nbsp;These are important questions. &nbsp;So, in the future, I'd like to repeat these tests using an artificial ear, which should better simulate a real ear. &nbsp;Will the results be different than on the 2cc coupler? &nbsp;I look forward to finding out!
