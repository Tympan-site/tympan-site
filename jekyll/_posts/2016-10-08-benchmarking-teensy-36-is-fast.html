---
layout: post
title: Benchmarking - Teensy 3.6 is Fast!
author: Chip
---


Fast but easy to program -- &nbsp;that's what I need for my audio processing projects. &nbsp;In <a href="https://openaudio.blogspot.com/2016/09/benchmarking-fft-speed.html">my previous post</a>, I loved the speed of the NXP K66 processor, but was frustrated with the NXP development environment. &nbsp; Well, thanks to PJRC and Kickstarter, the solution has arrived...via US Mail. &nbsp;Welcome to the new Teensies! &nbsp;Based on my tests, it looks like audio hacking just got a whole lot more fun.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-pDtmN27XpFw/V_MRYlxxXOI/AAAAAAAAD6k/nBil6tTDH4APmnVGXDwAfhYmT3oJ11UpQCLcB/s1600/TeensyStartGraphic.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="266" src="https://2.bp.blogspot.com/-pDtmN27XpFw/V_MRYlxxXOI/AAAAAAAAD6k/nBil6tTDH4APmnVGXDwAfhYmT3oJ11UpQCLcB/s400/TeensyStartGraphic.png" width="400" /></a></div><br /><u>Teensy?</u>&nbsp; Teensy is a line of microcontroller boards that are much more capable than the standard Arduino boards, but that can still be programmed using the friendly Arduino development environment (the "Arduino IDE"). &nbsp;I've used one of the existing Teensy boards (Teensy 3.2) on a number of projects and it definitely achieves its goal: it's a powerful, fast little board that is really easy to program. <br /><br /><u>New Teensies!</u>&nbsp; Through <a href="https://www.kickstarter.com/projects/paulstoffregen/teensy-35-and-36">just-completed&nbsp;Kickstarter</a>, Teensy has expanded its line of boards by adding the Teensy 3.5 and Teensy 3.6. &nbsp;As can be seen in the table below, the Teensy 3.5 and 3.6 have a faster clock speed and have more RAM. &nbsp;The specs on the Teensy 3.6 match by my loved-and-hated FRDM-K66F board from NXP. &nbsp;The increased capabilities of the Teensy 3.5 and 3.6 relative to the older Teensy (and relative to Arduino) should really help in computationally-heavy tasks, such as processing audio.<br /><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-BZiGUBWbj68/V_TfOv6aojI/AAAAAAAAD7I/0hhTmJlrs4QEmcvJaglyu7uxc-SECizzQCLcB/s1600/Table%2Bof%2BBoards.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="163" src="https://3.bp.blogspot.com/-BZiGUBWbj68/V_TfOv6aojI/AAAAAAAAD7I/0hhTmJlrs4QEmcvJaglyu7uxc-SECizzQCLcB/s640/Table%2Bof%2BBoards.png" width="540" /></a></div><br /><u>Floating-Point Prowess</u>. &nbsp;For me, the best feature of the new Teensies is the inclusion of a floating-point unit (FPU), which will accelerate calculations with floating-point numbers. &nbsp;This will makes it much easier to hack together audio processing algorithms. &nbsp;I loved the performance of the NXP FRDM-K66 board because its FPU made it stunningly fast on floating-point FIR and FFT operations. &nbsp;I'm hoping that the Teensy 3.6 is able to match the speed of the FRDM-K66. &nbsp;If it can, I can leave behind the FRDM-K66 board and never again have to struggle with NXP's development environment.<br /><u><br /></u><u>Programming the New Teensies.</u>&nbsp; To evaluate the new Teensy boards, I'm going to re-run my FFT benchmark tests (on GitHub <a href="https://github.com/chipaudette/OpenAudio/tree/master/Arduino/Audio%20Processing%20Benchmarking/FIR_FFT_Benchmarking">here</a>). &nbsp;First, I had to get the latest "<a href="http://www.pjrc.com/teensy/teensyduino.html">Teensyduino</a>" software from PJRC (to get support for the new boards into the Arduino IDE). &nbsp;Then, I simply opened up my FFT benchmarking sketch and recompiled. &nbsp;It was previously written for the Teensy 3.2 and now, without any changes, it compiled successfully for the Teensy 3.5/3.6. &nbsp;This is the ease-of-use that I was hoping for!<br /><br /><u>Speed Results.</u>&nbsp; I ran my bechmarking tests on the new boards and complied the results in the table below. &nbsp;It shows how many FFTs each board could complete per second. &nbsp;It's my raw data. &nbsp;It is hard to see the interesting trends in this table, so let's jump over the table and look at something simpler...<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-oeNsknGWC74/V_MRsZiWvLI/AAAAAAAAD6w/WTF_3mxbWRoFhWEJbvcsKZkxR5L72y6rQCLcB/s1600/Table%2Bof%2BSpeed.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="412" src="https://4.bp.blogspot.com/-oeNsknGWC74/V_MRsZiWvLI/AAAAAAAAD6w/WTF_3mxbWRoFhWEJbvcsKZkxR5L72y6rQCLcB/s640/Table%2Bof%2BSpeed.png" width="540" /></a></div><br /><u>Which Board is Fastest?</u>&nbsp; Below is a bar chart comparing the speed of each board for a 128-point FFT. &nbsp;I shows the speed when using Int32 data types and when using Float32 data types (the two most likely used in audio processing). &nbsp;Two results stand out:<br /><ul><li>The Teensy 3.6 is the overall winner, even beating the FRDM-K66F. &nbsp;While that is a bit inexplicable, it's great!</li><li>The Teensy 3.5 and 3.6 are great for floating point calculations. &nbsp;Look at how big those red bars are! &nbsp;Clearly, the FPU in these newer boards makes a huge difference.</li></ul><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-kSaL86xouQ8/V_MRkVBcyYI/AAAAAAAAD6s/GJg0EtZ-eWc7XGLQm3jQ1sH15JEAovahgCLcB/s1600/Figure%2Bof%2BSpeeds.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="250" src="https://4.bp.blogspot.com/-kSaL86xouQ8/V_MRkVBcyYI/AAAAAAAAD6s/GJg0EtZ-eWc7XGLQm3jQ1sH15JEAovahgCLcB/s640/Figure%2Bof%2BSpeeds.png" width="540" /></a></div><br /><u>How Fast do I Need?</u>&nbsp; So the bars in the graph above are big. &nbsp;How do I know what bars are big enough? &nbsp;How do I know which are fast enough for audio processing? &nbsp;Well, like in my previous post, I want to know which boards can keep up with calculations that need to be done at audio rates. &nbsp;In this case, I want to know which boards can do FFT operations at audio rates. &nbsp;What does that mean?<br /><br /><u>FFTs for Audio Processing.</u>&nbsp; FFTs are interesting for audio because it means one can process audio in the frequency domain, which can be very convenient. &nbsp;To do frequency-domain processing, you need to do an FFT to get into the frequency domain and you need to do an IFFT (which is basically the same computational load as an FFT) to get back out of the frequency domain. &nbsp;Then, because of windowing and other blah-blah-blah, you generally overlap your audio data blocks by 50%, which means that each audio block needs four FFT-like operations. &nbsp;Can this get done in real time?<br /><br /><u>Keeping up with Audio.</u>&nbsp; Because I measured how many FFTs each board can do per second, I can estimate the maximum audio sample rate (samples per second) that each board can support while still doing four FFTs per data block. &nbsp;A typical sample rate used for audio is 44 kHz. &nbsp;My results below show which boards can sustain at least 44 kHz (shown in green) versus those that cannot (shown in red).<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-jDR__5VWpcM/V_MRwZw4FXI/AAAAAAAAD60/eEQAdAKRbiQAR_mfsU6P2v3M_qmRfJ5tQCLcB/s1600/Table%2Bof%2BMax%2BSample%2BRate.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="122" src="https://3.bp.blogspot.com/-jDR__5VWpcM/V_MRwZw4FXI/AAAAAAAAD60/eEQAdAKRbiQAR_mfsU6P2v3M_qmRfJ5tQCLcB/s640/Table%2Bof%2BMax%2BSample%2BRate.png" width="540" /></a></div><br /><u>Integer vs Floating-Point Results.</u> &nbsp;As can be seen in the table, the Teensy 3.2 is fast enough for audio if I'm using integer data types (Int16 or Int32). &nbsp;It is not fast enough to use Floats. &nbsp;The new Teensy 3.5 and 3.6 are faster than the Teensy 3.2, especially on Floats. &nbsp;The Teensy 3.6 just screams on Floats -- it has enough processing power to sustain a sample rate over 300 kHz for frequency-domain processing. &nbsp;Wow. &nbsp;This is exactly the result that I was hoping to see.<br /><br /><u>Conclusion.</u>&nbsp; For my audio processing projects, it looks like the Teensy 3.6 is the best choice. &nbsp;It's really fast, yet it can be easily programmed through the comfortable and friendly Arduino IDE. &nbsp;I'm very pleased. <br /><br /><u>Next Step:</u>&nbsp;&nbsp;My next step is to join the Teensy 3.6 to an audio interface (such as the Teensy Audio Board) so that I can leave these synthetic benchmarks behind and start playing with actual audio. &nbsp;It's gonna be fun!<br /><br /><u>Extra Credit</u>: &nbsp;How much faster are the new Teensies vs the Teensy 3.2? &nbsp;The Teensy 3.6 is 16x faster than the Teensy 3.2 on Floats. &nbsp;Dang, that's fast. &nbsp;Again, this must be due to the FPU in the new units.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-_j4I10BcKCs/V_jsB4UkF_I/AAAAAAAAD7Y/ZuSTf3fswDcgO1QdJ83XPF0mkOoYRMZ8QCLcB/s1600/Table%2Bof%2BRelative%2BSpeed.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="126" src="https://1.bp.blogspot.com/-_j4I10BcKCs/V_jsB4UkF_I/AAAAAAAAD7Y/ZuSTf3fswDcgO1QdJ83XPF0mkOoYRMZ8QCLcB/s320/Table%2Bof%2BRelative%2BSpeed.png" width="320" /></a></div><br /><u>Follow-Up:</u>&nbsp; I made my own&nbsp;<a href="http://openaudio.blogspot.com/2016/11/a-teensy-hearing-aid.html">Teensy Hearing Aid</a>&nbsp;using a Teensy 3.6 and a Teensy Audio Board. &nbsp;It's fun!
