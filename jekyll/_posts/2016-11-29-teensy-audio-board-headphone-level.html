---
layout: post
title: Teensy Audio Board Headphone Level
author: Chip
image: https://1.bp.blogspot.com/-aK0KWyI3M1Y/WD1ynwSSKPI/AAAAAAAAEDY/_S9yWkGi1IAkHH-h6bogAqboVyomy7C-QCK4B/s640/SGTL_Signal_Flow_Headphone.png
---


For my home-brew <a href="http://openaudio.blogspot.com/2016/11/a-teensy-hearing-aid.html">Teensy Hearing Aid</a>, I'm using the <a href="https://www.pjrc.com/store/teensy3_audio.html">Teensy Audio Board</a> as my audio interface. &nbsp;The heart of the Teensy Audio Board is the <a href="http://www.nxp.com/products/media-and-audio-processing/data-converters/audio-converters/audio-codec/ultra-low-power-audio-codec:SGTL5000">Freescale SGTL5000</a> stereo codec. &nbsp;This codec is very flexible, with lots of virtual knobs for tuning your system to suit your own application. &nbsp;For my hearing aid, it is important for me to understand all settings related to loudness. &nbsp;So, today, I'm going to look at the impact of the headphone volume control.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-aK0KWyI3M1Y/WD1ynwSSKPI/AAAAAAAAEDY/_S9yWkGi1IAkHH-h6bogAqboVyomy7C-QCK4B/s1600/SGTL_Signal_Flow_Headphone.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" height="270" src="https://1.bp.blogspot.com/-aK0KWyI3M1Y/WD1ynwSSKPI/AAAAAAAAEDY/_S9yWkGi1IAkHH-h6bogAqboVyomy7C-QCK4B/s640/SGTL_Signal_Flow_Headphone.png" width="560" /></a></div><br /><br /><u>System Block Diagram:</u>&nbsp; The figure above is taken from the <a href="http://www.nxp.com/assets/documents/data/en/data-sheets/SGTL5000.pdf">datasheet </a>for the SGTL5000. &nbsp;All of the blocks in yellow &nbsp;are analog gain stages. &nbsp;The headphone volume control is at the end of the chain, on the upper right. &nbsp;It says that the headphone volume can be adjusted from -52 dB to&nbsp;+12 dB.<br /><br /><u>Teensy Audio Library:</u>&nbsp; Because this SGTL5000 is embedded within the Teensy Audio Board, I control it via the <a href="http://www.pjrc.com/teensy/td_libs_Audio.html">Teensy Audio Library</a>. &nbsp;The library hides many of the details of controlling the SGTL5000. &nbsp;For example, it allows the user to control the headphone volume simply by commanding a value somewhere between 0.0 and 1.0. &nbsp;Presumably, 0.0 maps to the -52 dB setting and 1.0 maps to the&nbsp;+12 dB setting.<br /><br /><u>Measuring the Response:</u>&nbsp; To see what this means for my system, I wrote a sketch for the Teensy that uses the Teensy Audio Library to continuously generate a nearly full-scale sine wave and to output it via the headphone jack (code is shared <a href="https://github.com/chipaudette/OpenAudio_blog/tree/master/2016-11-29%20Teensy%20Audio%20Signal%20Levels/TestHeadphoneOutputScaling">here</a>). &nbsp;The volume setting for the headphone output is controlled via potentiometer on the Teensy Audio Board. &nbsp;To see the effect of the headphone volume setting, I measured the RMS voltage produced at the headphone jack using a Fluke handheld digital multi-meter.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-h5VdvgFWj9g/WD1y9yKT81I/AAAAAAAAEDg/ZfVtqya6-ZEZSqLgsAb3V5R3V6d3slZNACK4B/s1600/HeadphoneLevel.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="252" src="https://2.bp.blogspot.com/-h5VdvgFWj9g/WD1y9yKT81I/AAAAAAAAEDg/ZfVtqya6-ZEZSqLgsAb3V5R3V6d3slZNACK4B/s400/HeadphoneLevel.png" width="400" /></a></div><br /><u>Results:</u>&nbsp; The figure above shows the values that I measured. &nbsp;As can be seen, the response in the middle section is linear, which is great. &nbsp;At the low end, my results do deviate from linear, but that's presumably because my multi-meter had difficulty measuring such small signals (-50dBV is only 3.2 mVrms!).<br /><br /><u>Saturation</u>: &nbsp;The interesting result happens at the high end of my graph where I turn up the volume control to its highest values. &nbsp;Here, my results saturate -- increasing the volume command does <b>not </b>increase the output voltage. &nbsp;The break-over point is at a command of about 0.85. &nbsp;This corresponds to an output signal level of +1.5 dBV, which is 1.2 Vrms, which is 3.4 Vpk-pk. &nbsp;Since the power supply to the SGTL5000 is only 3.3V, it is not surprising that the output saturates when I ask for the output signal to be greater than the power rails. <br /><br /><u>Best Setting to Use:</u>&nbsp; Saturation will sound bad. &nbsp;It will cause distortion in the audio. &nbsp;To keep my hearing aid sounding good, I want to avoid this saturation. &nbsp;If my full-scale sine wave causes saturation at a volume setting of 0.85, I am going to set my volume to 0.8.<br /><br />
